pipeline {
    agent { label 'windows-node'}
    environment{
         NVM_INSTALLER_URL = 'https://raw.githubusercontent.com/coreybutler/nvm-windows/main/nvm-setup.exe'
    }
    stages{
        stage('setup nvm'){
            steps{
                script {
                     def nvmCheck = powershell(script: 'Get-Command nvm -ErrorAction SilentlyContinue', returnStatus: true)
                    if (nvmCheck != 0) {
                        echo 'NVM is not installed. Installing now...'
                        powershell """
                        Invoke-WebRequest -Uri '${env.NVM_INSTALLER_URL}' -OutFile 'nvm-setup.exe'
                        Start-Process 'nvm-setup.exe' -ArgumentList '/SILENT' -Wait
                        """
                        echo 'NVM installed successfully.'
                    } else {
                        echo 'NVM is already installed.'
                    }
                }
            }
        }
    }
}